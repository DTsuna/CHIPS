      subroutine avrge(n,dt,dmass)

      include 'inclm1.f'

      parameter(r32 = 2.d0/3.d0)
      real*8 dmass(*)
      real*8 taul(mn),pl(mn),ul(mn),arl(mn),gl(mn),g1l(mn)
     &      ,taur(mn),pr(mn),ur(mn),arr(mn),gr(mn),g1r(mn)
      real*8 taum(mn), pm(mn), um(mn), arm(mn), gm(mn), g1m(mn)
     &      ,taup(mn), pp(mn), up(mn), arp(mn), gp(mn), g1p(mn)

      common /avarg/ taum, pm, um, arm, gm, g1m, taup, pp,
     &               up, arp, gp, g1p
      common /intp/ taul, pl, ul, arl, gl, g1l,
     &              taur, pr, ur, arr, gr, g1r
      do 10 j = 2, n-1
         j1 = j+1
         xx = sqrt(g1(j)/tau(j)*p(j))*ar(j)*dt/dmass(j)
         xp = sqrt(g1(j1)/tau(j1)*p(j1))*ar(j1)*dt/dmass(j1)
         dtauj = taur(j)-taul(j)
         tau6j = 6.d0*(tau(j)-0.5d0*(taul(j)+taur(j)))
         dtauj1 = taur(j1)-taul(j1)
         tau6j1 = 6.d0*(tau(j1)-0.5d0*(taul(j1)+taur(j1)))
         taup(j) = taur(j)-0.5d0*xx*(dtauj-(1.d0-r32*xx)*tau6j)
         taum(j) = taul(j1)+0.5d0*xp*(dtauj1+(1.d0-r32*xp)*tau6j1)
         dpj = pr(j)-pl(j)
         p6j = 6.d0*(p(j)-0.5d0*(pl(j)+pr(j)))
         dpj1 = pr(j1)-pl(j1)
         p6j1 = 6.d0*(p(j1)-0.5d0*(pl(j1)+pr(j1)))
         pp(j) = pr(j)-0.5d0*xx*(dpj-(1.d0-r32*xx)*p6j)
         pm(j) = pl(j1)+0.5d0*xp*(dpj1+(1.d0-r32*xp)*p6j1)
         duj = ur(j)-ul(j)
         u6j = 6.d0*(u(j)-0.5d0*(ul(j)+ur(j)))
         duj1 = ur(j1)-ul(j1)
         u6j1 = 6.d0*(u(j1)-0.5d0*(ul(j1)+ur(j1)))
         up(j) = ur(j)-0.5d0*xx*(duj-(1.d0-r32*xx)*u6j)
         um(j) = ul(j1)+0.5d0*xp*(duj1+(1.d0-r32*xp)*u6j1)
         darj = arr(j)-arl(j)
         ar6j = 6.d0*(ar(j)-0.5d0*(arl(j)+arr(j)))
         darj1 = arr(j1)-arl(j1)
         ar6j1 = 6.d0*(ar(j1)-0.5d0*(arl(j1)+arr(j1)))
         arp(j) = arr(j)-0.5d0*xx*(darj-(1.d0-r32*xx)*ar6j)
         arm(j) = arl(j1)+0.5d0*xp*(darj1+(1.d0-r32*xp)*ar6j1)
         dgj = gr(j)-gl(j)
         g6j = 6.d0*(g(j)-0.5d0*(gl(j)+gr(j)))
         dgj1 = gr(j1)-gl(j1)
         g6j1 = 6.d0*(g(j1)-0.5d0*(gl(j1)+gr(j1)))
         gp(j) = gr(j)-0.5d0*xx*(dgj-(1.d0-r32*xx)*g6j)
         gm(j) = gl(j1)+0.5d0*xp*(dgj1+(1.d0-r32*xp)*g6j1)
         dg1j = g1r(j)-g1l(j)
         g16j = 6.d0*(g1(j)-0.5d0*(g1l(j)+g1r(j)))
         dg1j1 = g1r(j1)-g1l(j1)
         g16j1 = 6.d0*(g1(j1)-0.5d0*(g1l(j1)+g1r(j1)))
         g1p(j) = g1r(j)-0.5d0*xx*(dg1j-(1.d0-r32*xx)*g16j)
         g1m(j) = g1l(j1)+0.5d0*xp*(dg1j1+(1.d0-r32*xp)*g16j1)
 10   continue
      taup(2) = taum(2)
      pp(2) = pm(2)
      up(2) = -um(2)
      arp(2) = -arm(2)
      gp(2) = gm(2)
      g1p(2) = g1m(2)
      taum(n) = taur(n)
      taup(n) = taur(n)
      pm(n) = pr(n)
      pp(n) = pr(n)
      um(n) = ur(n)
      up(n) = ur(n)
      arm(n) = arr(n)
      arp(n) = arr(n)
      gm(n) = gr(n)
      gp(n) = gr(n)
      g1m(n) = g1r(n)
      g1p(n) = g1r(n)
      return
      end
